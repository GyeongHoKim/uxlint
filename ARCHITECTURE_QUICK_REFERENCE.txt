==========================================
UXLINT ARCHITECTURE - QUICK REFERENCE
==========================================

CODEBASE STATS:
  - 39 TypeScript files
  - ~6,030 lines total
  - 6 Layers: CLI → Components → Hooks → Services → Models → MCP Client

====== LAYER 1: ENTRY POINTS ======
cli.tsx (48 lines)
  └─ Parses CLI args (meow framework)
     └─ Routes to app.tsx with mode (analysis/interactive/normal)
        
app.tsx (172 lines)
  ├─ Renders appropriate component based on mode
  ├─ Handles dotenv loading
  └─ Uses useConfig hook for config lifecycle

====== LAYER 2: COMPONENTS (UI) ======
7 React/Ink components:
  ├─ analysis-runner.tsx      → Orchestrates analysis workflow UI
  ├─ analysis-progress.tsx    → Progress display
  ├─ config-wizard.tsx        → Interactive config creation
  ├─ config-summary.tsx       → Config display
  ├─ header.tsx               → App header
  ├─ prompt-step.tsx          → Wizard step
  └─ user-input*.tsx          → Input components

RULE: Components import ONLY hooks + model types
      NO direct service or MCP imports

====== LAYER 3: HOOKS (STATE MANAGEMENT) ======
5 Custom React hooks:
  ├─ use-analysis.ts          → Main orchestrator (286 lines)
  │    ├─ Manages AnalysisState
  │    ├─ Coordinates McpPageCapture
  │    ├─ Calls analyzePageWithAi
  │    └─ Generates reports
  │
  ├─ use-config.ts            → Config loading (112 lines)
  │    └─ Manages ConfigState
  │
  ├─ use-mcp-client.ts        → MCP client lifecycle
  ├─ use-browser-automation.ts → Browser ops
  └─ use-wizard.ts            → Wizard state machine

RULE: Hooks import models + services
      Hooks coordinate between UI and domain layers

====== LAYER 4: SERVICES (ADAPTERS) ======
2 Service modules:
  ├─ ai-service.ts (313 lines)
  │    ├─ buildSystemPrompt()
  │    ├─ buildAnalysisPrompt()
  │    ├─ parseAnalysisResponse()
  │    └─ analyzePageWithAi() ← MAIN ANALYSIS ENGINE
  │         └─ Calls Claude API with MCP tools
  │
  └─ mcp-page-capture.ts (212 lines)
       ├─ McpPageCapture class
       ├─ capturePage()      → Navigate + screenshot + snapshot
       ├─ getMcpClient()     → Expose MCP client
       └─ close()            → Cleanup

RULE: Services import models + mcp/client
      Services wrap external SDKs (Vercel AI, MCP)

====== LAYER 5: MODELS (DOMAIN) ======
14 Pure business logic files:
  
  Core Types:
    ├─ analysis.ts (283 lines)
    │   └─ PageAnalysis, UxFinding, UxReport, AnalysisState
    ├─ config.ts (129 lines)
    │   └─ UxLintConfig, Page, Persona + type guards
    └─ wizard-state.ts
       └─ ConfigurationData, SaveOptions
  
  I/O & Transformation:
    ├─ config-io.ts (404 lines)
    │   └─ loadConfig, saveConfig, parseConfig, validateConfig
    ├─ config-builder.ts
    │   └─ Config data transformation
    └─ input-processor.ts
       └─ URL normalization, validation
  
  Utilities:
    ├─ report-generator.ts (179 lines)
    │   └─ generateMarkdownReport, writeReportToFile
    ├─ mcp-tool-adapter.ts (102 lines)
    │   └─ convertMcpToolsToClaudeTools
    ├─ env-config.ts
    │   └─ loadEnvConfig
    ├─ validation-engine.ts
    │   └─ Reusable validators
    ├─ theme.ts
    │   └─ Theme configuration
    ├─ session-manager.ts
    ├─ errors.ts
    │   └─ Custom error classes
    └─ index.ts
        └─ Barrel export

RULE: Models contain NO I/O or framework dependencies
      Models are pure TypeScript/logic

====== LAYER 6: MCP CLIENT (INFRASTRUCTURE) ======
6 MCP protocol implementation files:
  ├─ mcp-client.ts (238 lines)
  │   ├─ McpClient class (main client)
  │   ├─ connect()     → Start stdio transport
  │   ├─ listTools()   → Get available tools
  │   ├─ callTool()    → Execute tool (with timeout)
  │   └─ close()       → Cleanup
  │
  ├─ playwright-client.ts
  │   ├─ PlaywrightClient class
  │   ├─ navigate()       → browser_navigate tool
  │   ├─ takeScreenshot() → browser_take_screenshot tool
  │   └─ getSnapshot()    → browser_snapshot tool
  │
  ├─ types.ts
  │   ├─ Tool, NavigateResult, ScreenshotResult, SnapshotResult
  │   └─ McpConfig, ToolInvocation, McpToolResponse
  │
  ├─ config.ts
  │   └─ getMcpConfigFromEnv()
  │
  ├─ errors.ts
  │   ├─ McpError, ConnectionError, ToolInvocationError
  │   └─ ServerNotAvailableError, TimeoutError
  │
  └─ validators.ts
      └─ Input validation for MCP operations

RULE: MCP Client is self-contained infrastructure layer
      Direct interaction with external MCP servers

====== DEPENDENCY FLOW ======

User Input
    ↓
  CLI (cli.tsx)
    ↓
  App (app.tsx)
    ↓
  Components
    ↓
  Hooks (useAnalysis, useConfig)
    ↓
  Services (ai-service, mcp-page-capture)
    ↓
  Models (analysis, config, report-generator, mcp-tool-adapter)
    ↓
  MCP Client (mcp-client, playwright-client)
    ↓
  External Systems (Claude API, Playwright MCP Server)

====== MAIN ANALYSIS WORKFLOW ======

1. User runs: uxlint [--interactive]
   └─ cli.tsx determines mode

2. If mode = 'analysis':
   └─ Load .uxlintrc.json/.yaml
   └─ useConfig hook loads config

3. AnalysisRunner component starts analysis
   └─ Calls useAnalysis.runAnalysis()

4. For each page in config:
   a. Initialize McpPageCapture
   b. Call analyzePageWithAi():
      - Connect to MCP server
      - List available tools
      - Convert tools to Claude format
      - Stream Claude response (with tool calling)
      - Parse findings
   c. Accumulate PageAnalysis

5. Generate UxReport:
   - Aggregate all findings
   - Sort by severity
   - Generate markdown

6. Write report to file
   └─ config.report.output

7. Exit with status code

====== KEY ABSTRACTIONS ======

McpClient (hide MCP SDK)
  └─ PlaywrightClient (wrap Playwright operations)
      └─ McpPageCapture (high-level "capture page")

analyzePageWithAi (hide Claude API + tools + parsing)
  └─ Uses Vercel AI SDK + MCP tools

ConfigIo (separate concerns: read/parse/validate)
  └─ Independent functions, no state

useAnalysis Hook (orchestrate workflow)
  └─ Coordinates McpPageCapture + analyzePageWithAi

====== DEPENDENCY RULES ======

✓ NO circular dependencies
✓ Unidirectional flow (top-to-bottom)
✓ Components → Hooks → Services/Models → MCP
✓ Models are completely independent
✓ Services wrap external SDKs
✓ Hooks coordinate everything

====== POTENTIAL IMPROVEMENTS ======

1. Extract config-io into smaller modules
2. Create error hierarchy for better handling
3. Use dependency injection pattern for service initialization
4. Add more abstraction if MCP usage grows

====== FILES TO READ FIRST ======

1. /home/user/uxlint/source/hooks/use-analysis.ts (286 lines)
   → Understands the main workflow

2. /home/user/uxlint/source/models/analysis.ts (283 lines)
   → Core domain types

3. /home/user/uxlint/source/services/ai-service.ts (313 lines)
   → How Claude integration works

4. /home/user/uxlint/source/mcp/client/mcp-client.ts (238 lines)
   → Infrastructure layer

